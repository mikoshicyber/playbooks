all:
  vars:
    ansible_winrm_transport: ntlm
    ansible_connection: winrm
    ansible_winrm_message_encryption: auto
    ansible_winrm_server_cert_validation: ignore
    ansible_port: 5985
    ansible_user: Administrator
    ansible_password: "strongpassword"
    # remote_source: "\\\\192.168.88.70\\obmen\\autodownloads"
    dest: "C:\\temp\\deploy"
    telegram_token: ""
    telegram_chat_id: 
    patterns__all:
      - { regex: "audacity-win-[\\d.]+-64bit.exe", creates_path: 'C:\Program Files\Audacity\Audacity.exe', mode: "exe", args: ["/S","/verysilent","/NORESTART"], pre: ["taskkill /im audacity* /f"] }
      - { regex: "XnConvert-win-x64", creates_path: 'C:\Program Files\XnConvert\xnconvert.exe', mode: "exe", args: ["/S", "/verysilent"], force: false }
      - { regex: "Firefox", creates_path: 'C:\Program Files\Mozilla Firefox\firefox.exe', mode: "exe", args: ["/S","/verysilent","/NORESTART"] }
      - { regex: "windows_exporter-.*-amd64.msi", mode: "msi", args: [ '/quiet', '/norestart', 'ENABLED_COLLECTORS="[defaults],process,textfile"', 'TEXTFILE_DIRS="C:\metrics"'], pre: ["sc stop windows_exporter"] }
      - { regex: "K-Lite_Codec_Pack_.+_Mega.exe", creates_path: 'C:\Program Files (x86)\K-Lite Codec Pack\MPC-HC64\mpc-hc64.exe', mode: "exe", args: ["/S", "/VERYSILENT", "/NORESTART"] }
      - { regex: "Thunderbird", creates_path: 'C:\Program Files\Mozilla Thunderbird\thunderbird.exe', mode: "exe", args: ["/S","/verysilent","/NORESTART"], pre: "taskkill /f /im thunderbird.exe" }
      - { regex: "XnViewMP-win-x64", creates_path: 'C:\Program Files\XnViewMP\xnviewmp.exe', mode: "exe", args: ["/S", "/verysilent"], force: false }
      - { regex: "ShareX", creates_path: 'C:\Program Files\ShareX\ShareX.exe', mode: "exe", args: ["/VERYSILENT", "/NORESTART", "/NORUN"], pre: ['taskkill /im ShareX.exe /f'] }
      - { regex: "libreoffice.*_Win_x86-64.msi", mode: "msi", args: ["/quiet", "/norestart"], pre: ["taskkill /im soffice.bin /f","taskkill /im soffice.exe /f"] }
      - { regex: "libreoffice.*help", mode: "msi", args: ["/quiet", "/norestart"] }
      - { regex: "draw.io-.*-windows-installer.exe", creates_path: 'C:\Program Files\draw.io\draw.io.exe', mode: "exe", args: ["/S","/verysilent","/NORESTART"] }
      - { regex: "Nextcloud-.*--x64.msi", mode: "msi", args: ["/quiet", "/norestart"] }
      - { regex: "7z[\\d.]+-x64.exe", creates_path: 'C:\Program Files\7-Zip\7zFM.exe', mode: "exe", args: ["/S"] }
      - { regex: "vlc-[\\d.]+-win64.exe", creates_path: 'C:\Program Files\VideoLAN\VLC\vlc.exe', mode: "exe", args: ["/S", "/verysilent"] }
      - { regex: "inkscape-.+-x64.exe", creates_path: 'C:\Program Files\Inkscape\bin\inkscape.exe', mode: "exe", args: ["/S", '/D="C:\Program Files\Inkscape"'], pre: ['"C:\Program Files\Inkscape\Uninstall.exe" /S']  }
      - { regex: "mumble_client-[\\d.]+.x64.msi", mode: "msi", args: ["/quiet", "/norestart"] }
      ## updating too often
      #- { regex: "Far[\\d.ab]+.x64.[\\d]+.msi", mode: "msi", args: ["/quiet", "/norestart"] }
      - { regex: "tor-browser", mode: "exe", args: ["/S", "/verysilent"] }
      - { regex: "gimp", creates_path: 'C:\Program Files\GIMP 2\bin\gegl.exe', mode: "exe", args: ["/S", "/verysilent", "/currentuser"] }
  children:
    dev_hosts:
      hosts:
        user-pc:
        notebook:
      vars:
          patterns__dev_hosts:
            - { regex: "keepass", creates_path: 'C:\Program Files (x86)\KeePass Password Safe 2\KeePass.exe', mode: "exe", args: ["/S", "/verysilent"], force: false, pre: ['taskkill /im "*keepass*" /f'] }
            - { regex: "openconnect", creates_path: 'C:\Program Files\OpenConnect-GUI\openconnect-gui.exe', mode: "exe", args: ["/S", "/verysilent"], force: false }
            - { regex: "openvpn", mode: "msi", args: ["/quiet", "/norestart"], force: false }
            - { regex: "putty-64bit-[\\d.]+-installer.msi", mode: "msi", args: ["/quiet", "/norestart"] }
            - { regex: "npp.+Installer.x64.exe", creates_path: 'C:\Program Files\Notepad++\notepad++.exe', mode: "exe", args: ["/S", "/VERYSILENT", "/NORESTART"] }
            - { regex: "WinSCP-.*-Setup", creates_path: 'C:\Program Files (x86)\WinSCP\WinSCP.exe', mode: "exe", args: ["/S", "/VERYSILENT", "/NORESTART"] }
            - { regex: "Freelens-.*-windows-amd64.msi", mode: "msi", args: ["/quiet", "/norestart"], pre: ["taskkill /im Freelens* /f"] }
            - { regex: "VSCodeUserSetup", creates_path: 'C:\Users\{{ ansible_user }}\AppData\Local\Programs\Microsoft VS Code\Code.exe', mode: "exe", args: ["/VERYSILENT", "/CURRENTUSER", "/NORESTART", "/MERGETASKS=!runcode"], pre: ["taskkill /im Code.exe /f"] }
            - { regex: "HeidiSQL", creates_path: 'C:\Program Files\HeidiSQL\heidisql.exe', mode: "exe", args: ["/SP", "/FORCECLOSEAPPLICATIONS", "/VERYSILENT", "/ALLUSERS", "/NORESTART"] }
            - { regex: "dbeaver", creates_path: 'C:\Users\{{ ansible_user }}\AppData\Local\DBeaver\dbeaver.exe', mode: "exe", args: ["/S", "/currentuser"] }
            - { regex: "tor-expert-bundle-windows-x86_64-[\\d.-]+.tar.gz", mode: "arc", dest: "C:\\Program Files\\TorBundle", force: false,
                pre: [ "taskkill /im tor.exe /f || echo not found", 'rd /q /s "C:\Program Files\TorBundle"' ]              }
            - { regex: "ffmpeg-master-latest-win64-gpl.zip", mode: "arc", dest: 'C:\Program Files\', force: false,
                files: ["ffmpeg-master-latest-win64-gpl/bin/ffplay.exe","ffmpeg-master-latest-win64-gpl/bin/ffprobe.exe","ffmpeg-master-latest-win64-gpl/bin/ffmpeg.exe"]}
    win_hosts:
      hosts:
        user-pc:
          ansible_host: 192.168.88.185
          patterns__user-pc:
            #- { regex: "tesseract-ocr-w64-setup-[\\d.]+.exe', mode: "exe", args: ["/S", '/D='C:\Program Files\Tesseract-OCR"', "/LANG=rus"], force: false }
            - { regex: "blender-.*-windows.amd64-release.msi", mode: "msi", args: ["/quiet", "/norestart"] }
            - { product_id: "Krita", state: "present", force: false, regex: "krita-x64-[\\d.-]+-setup.exe", mode: "exe", args: ["/S", "/verysilent"] }
            - { product_id: "OBS Studio", state: "present", force: force, regex: "OBS-Studio-[\\d.-]+-Windows-x64-Installer.exe", mode: "exe", args: ["/S", "/verysilent"] }
            - { regex: "VirtualBox-.*-Win.exe", creates_path: 'C:\Program Files\Oracle\VirtualBox\VirtualBox.exe', mode: "exe", args: ["--silent","--ignore-reboot"] }
            - { regex: "AIMP", mode: "exe", args: ['/AUTO="C:\Users\{{ ansible_user }}\Desktop\AIMP"', "/VERYSILENT"] }
            - { product_id: "{9EBED8F8-BD2F-4561-B5A3-628A8815F51F}", regex: "VeraCrypt_Setup_x64_[\\d.]+.msi", state: "present", force: false, mode: "msi", args: ["/quiet", "ACCEPTLICENSE=YES", "/norestart"] }
        notebook:
          ansible_host: 192.168.88.104
          patterns__notebook:
            - { regex: "keepass", mode: "exe", args: ["/S", "/verysilent"], force: false, pre: ['taskkill /im keepass*.exe /f'] }
            - { force: false, regex: "OBS-Studio-[\\d.-]+-Windows-x64-Installer.exe", mode: "exe", args: ["/S", "/verysilent"]}
            - { regex: "AIMP", mode: "exe", args: ['/AUTO="C:\Users\{{ ansible_user }}\Desktop\AIMP"', "/VERYSILENT"] }
